<!-- webkit-test-runner [ IPCTestingAPIEnabled=true ] -->
<p>This test passes if WebKit does not crash.</p>
<script src="../resources/ipc.js"></script>
<script>
testRunner?.dumpAsText();
testRunner?.waitUntilDone();

setTimeout(async () => {
    if (!window.IPC)
        return testRunner?.notifyDone();

    const { CoreIPC } = await import('./coreipc.js');
    const renderingBackendIdentifier = randomIPCID();
    o58 = CoreIPC.newStreamConnection();
    CoreIPC.GPU.GPUConnectionToWebProcess.CreateRenderingBackend(
        0, { renderingBackendIdentifier : renderingBackendIdentifier, connectionHandle : o58 });
    o60 = o58.newInterface("RemoteRenderingBackend", renderingBackendIdentifier);

    const didInitializeReply = o58.connection.waitForMessage(renderingBackendIdentifier, IPC.messages.RemoteRenderingBackendProxy_DidInitialize.name, 1)
    o58.connection.setSemaphores(didInitializeReply[0].value, didInitializeReply[1].value);

    o60.CacheFilter({
        filter : {
            subclasses : {
                variantType : 'WebCore::CSSFilterRenderer',
                variant : {
                    functions : [
                        {
                            subclasses : {
                                variantType : 'WebCore::FEFlood',
                                variant : {
                                    floodColor : { data : {} },
                                    floodOpacity : 1.0,
                                    operatingColorSpace : {
                                        serializableColorSpace : {
                                            alias : {
                                                m_cgColorSpace : {
                                                    alias : {
                                                        variantType : 'RetainPtr<CFTypeRef>',
                                                        variant : {
                                                            object : {
                                                                alias : {
                                                                    variantType : 'std::nullptr_t',
                                                                    variant : null
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    ],
                    filterRenderingModes : 0,
                    filterScale : { width : 1.0, height : 1.0 },
                    filterRegion : {
                        location : { x : 0, y : 0 },
                        size : { width : 100, height : 100 }
                    }
                }
            }
        }
    });

    o58.connection.invalidate();
}, 20);

setTimeout(() => {
    testRunner?.notifyDone();
}, 500);
</script>
